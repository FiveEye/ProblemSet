dp1 = [0, 0, 1, 2, 4, 6, 8, 10, 12, 14, 16, 18, 21, 24, 27, 30, 34, 38, 42, 46, 49, 52, 55, 58, 61, 64, 67, 70, 73, 76, 79, 82, 86, 90, 94, 98, 102, 106, 110, 114, 119, 124, 129, 134, 139, 144, 149, 154, 160, 166, 172, 178, 182, 186, 190, 194, 198, 202, 206, 210, 214, 218, 222, 226, 230, 234, 238, 242, 246, 250, 254, 258, 262, 266, 270, 274, 278, 282, 286, 290, 295, 300, 305, 310, 315, 320, 325, 330, 335, 340, 345, 350, 355, 360, 365, 370, 376, 382, 388, 394, 400, 406, 412, 418, 424, 430, 436, 442, 448, 454, 460, 466, 473, 480, 487, 494, 501, 508, 515, 522, 529, 536, 543, 550, 555, 560, 565, 570, 575, 580, 585, 590, 595, 600, 605, 610, 615, 620, 625, 630, 635, 640, 645, 650, 655, 660, 666, 674, 680, 686, 692, 698, 703, 708, 713, 718, 723, 728, 733, 738, 743, 748, 753, 758, 763, 768, 773, 778, 783, 788, 793, 798, 803, 808, 813, 818, 823, 828, 833, 838, 843, 848, 853, 858, 863, 868, 873, 878, 883, 888, 893, 898, 904, 910, 916, 922, 928, 934, 940, 946, 952]    

class Solution(object):
    def getMoneyAmount(self, n):
        """
        :type n: int
        :rtype: int
        """
        dp = [[0 for x in range(n+1)] for y in range(n+1)]
        stk = [0 for x in range(n+1)] 
        for y in range(2,n+1):
            i = 0
            top = 1
            stk[0] = y-2
            for x in range(y-2, -1, -1):
                dp[x][y] = min(x+1 + dp[x+1][y], dp[x][y-1] + y)
                if i >= top:
                    i = top - 1
                #print("i", i ,stk[:top], top)
                while i < top - 1:
                    j = stk[i]
                    nj = stk[i+1]
                    if max(dp[x][j],dp[j+1][y]) + j >= max(dp[x][nj],dp[nj+1][y]) + nj:
                        i += 1
                    else:
                        break
                j = stk[i]
                #print(x,y,j+1, dp[x][j],dp[j+1][y])
                dp[x][y] = min(dp[x][y], max(dp[x][j],dp[j+1][y]) + j + 1)
                while top > 0:
                    j = stk[top-1]
                    if dp[j+1][y] + j >= dp[x][y] + x:
                        top -= 1
                    else:
                        break
                
                stk[top] = x-1
                top += 1
        #for i in range(n+1):
        #    if dp1[i] != dp[0][i]:
        #        print(i, dp1[i], dp[0][i])
        return dp[0][n]
